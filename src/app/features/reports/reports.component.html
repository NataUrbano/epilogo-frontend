<div class="reports-container">
  <div class="card">
    <!-- Header -->
    <div class="card-header">
      <h2>ğŸ“Š Reportes de Reservas</h2>
      <p>Genera y visualiza reportes en mÃºltiples formatos: HTML, PDF y CSV</p>
    </div>

    <!-- Content -->
    <div class="card-content">
      <!-- Formulario de filtros -->
      <form [formGroup]="filterForm" class="filter-form">
        <div class="filter-row">
          <div class="form-group">
            <label for="startDate">Fecha inicio:</label>
            <input type="date" id="startDate" formControlName="startDate" 
                   (change)="onFilterChange()" class="form-control">
          </div>

          <div class="form-group">
            <label for="endDate">Fecha fin:</label>
            <input type="date" id="endDate" formControlName="endDate" 
                   (change)="onFilterChange()" class="form-control">
          </div>

          <div class="form-group">
            <label for="status">Estado:</label>
            <select id="status" formControlName="status" (change)="onFilterChange()" class="form-control">
              <option *ngFor="let status of statusOptions" [value]="status.value">
                {{ status.label }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="format">Formato:</label>
            <select id="format" formControlName="format" class="form-control">
              <option *ngFor="let format of formatOptions" [value]="format.value">
                {{ format.icon }} {{ format.label }}
              </option>
            </select>
          </div>
        </div>

        <div class="filter-row">
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="overdueOnly" (change)="onFilterChange()">
              Solo mostrar reservas vencidas
            </label>
          </div>
        </div>

        <!-- Botones de acciÃ³n principales -->
        <div class="actions-row">
          <button type="button" class="btn btn-primary" (click)="generateReport()" [disabled]="loading">
            <span *ngIf="!loading">ğŸ“¥ Generar Reporte</span>
            <span *ngIf="loading">â³ Generando...</span>
          </button>

          <button type="button" class="btn btn-secondary" (click)="clearFilters()" [disabled]="loading">
            ğŸ—‘ï¸ Limpiar Filtros
          </button>
        </div>

        <!-- Botones de reportes rÃ¡pidos -->
        <div class="quick-actions">
          <h4>ğŸš€ Reportes RÃ¡pidos</h4>
          <div class="quick-buttons">
            <button type="button" class="btn btn-warning" (click)="generateOverdueReport()" [disabled]="loading">
              âš ï¸ Vencidas (HTML)
            </button>

            <button type="button" class="btn btn-danger" (click)="generateOverduePdfReport()" [disabled]="loading">
              ğŸ“„ Vencidas (PDF)
            </button>

            <button type="button" class="btn btn-success" (click)="generateMonthlyReport()" [disabled]="loading">
              ğŸ“Š Mensual (CSV)
            </button>

            <button type="button" class="btn btn-info" (click)="generateMonthlyHtmlReport()" [disabled]="loading">
              ğŸŒ Mensual (HTML)
            </button>
          </div>
        </div>
      </form>

      <!-- Mensajes -->
      <div *ngIf="message" class="alert" [ngClass]="'alert-' + messageType">
        {{ message }}
      </div>

      <hr>

      <!-- Tabla de datos -->
      <div class="table-container">
        <div class="table-header">
          <h3>Vista Previa de Datos</h3>
          <span class="record-count">{{ reportData.length }} registros encontrados</span>
        </div>

        <!-- Loading -->
        <div *ngIf="loading" class="loading-container">
          <div class="spinner"></div>
          <span>Cargando datos...</span>
        </div>

        <!-- Tabla -->
        <div class="table-wrapper" *ngIf="!loading">
          <table class="report-table" *ngIf="reportData.length > 0">
            <thead>
              <tr>
                <th>ID</th>
                <th>Usuario</th>
                <th>Email</th>
                <th>Libro</th>
                <th>Autor</th>
                <th>F. Reserva</th>
                <th>F. Esperada</th>
                <th>F. Real</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of reportData; let i = index" [ngClass]="{'row-even': i % 2 === 0}">
                <td>{{ item.reservationId }}</td>
                <td>{{ item.userName }}</td>
                <td>{{ item.userEmail }}</td>
                <td>{{ item.bookTitle }}</td>
                <td>{{ item.bookAuthor }}</td>
                <td>{{ formatDate(item.reservationDate) }}</td>
                <td>{{ formatDate(item.expectedReturnDate) }}</td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusClass(item.status, item.isOverdue)">
                    {{ getStatusText(item.status, item.isOverdue) }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- No data -->
          <div *ngIf="reportData.length === 0" class="no-data">
            <div class="no-data-icon">ğŸ“„</div>
            <p>No se encontraron registros con los filtros aplicados</p>
          </div>
        </div>
      </div>

      <!-- InformaciÃ³n de formatos -->
      <div class="format-info">
        <h4>ğŸ“‹ InformaciÃ³n de Formatos</h4>
        <div class="format-cards">
          <div class="format-card">
            <h5>ğŸŒ HTML</h5>
            <p>Se abre en el navegador. Ideal para visualizaciÃ³n y se puede imprimir como PDF.</p>
          </div>
          <div class="format-card">
            <h5>ğŸ“„ PDF</h5>
            <p>Archivo PDF optimizado para impresiÃ³n directa y distribuciÃ³n.</p>
          </div>
          <div class="format-card">
            <h5>ğŸ“Š CSV</h5>
            <p>Datos estructurados que se pueden abrir en Excel para anÃ¡lisis.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>